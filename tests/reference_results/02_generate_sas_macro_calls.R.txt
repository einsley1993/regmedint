### Running: /home/kyoshida/miniconda3/lib/R/bin/exec/R --slave --no-restore --file=02_generate_sas_macro_calls.R 
> 
> cat("
+ ###
+ ### Prepare environment
+ ################################################################################\n")

###
### Prepare environment
################################################################################
> 
> ## Record start time
> start_time <- Sys.time()
> cat("### Started ", as.character(start_time), "\n")
### Started  2020-03-24 22:31:59 
> 
> 
> ## Load packages
> library(tidyverse)
Registered S3 methods overwritten by 'ggplot2':
  method         from 
  [.quosures     rlang
  c.quosures     rlang
  print.quosures rlang
Registered S3 method overwritten by 'rvest':
  method            from
  read_xml.response xml2
── Attaching packages ─────────────────────────────────────────────────────────── tidyverse 1.2.1 ──
✔ ggplot2 3.1.1       ✔ purrr   0.3.3  
✔ tibble  2.1.1       ✔ dplyr   0.8.0.1
✔ tidyr   0.8.3       ✔ stringr 1.4.0  
✔ readr   1.3.1       ✔ forcats 0.4.0  
── Conflicts ────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
> 
> 
> cat("
+ ###
+ ### Construct macro call templates
+ ################################################################################\n")

###
### Construct macro call templates
################################################################################
> 
> common_string <- "
+ /** Set libname */
+ libname w './';
+ 
+ /* Load SAS macro */
+ %include './mediation.sas';
+ 
+ /* Load data */
+ proc import datafile = './data-pbc_cc.csv'
+     out = pbc_cc
+     dbms = csv
+     replace;
+ run;
+ "
> 
> macro_call_string_fmt <- "
+ %%mediation(
+     data = pbc_cc,
+     yvar = %s,
+     avar = %s,
+     mvar = %s,
+     cvar = %s,
+     a0 = %s,
+     a1 = %s,
+     m = %s,
+     yreg = %s,
+     mreg = %s,
+     interaction = %s,
+     casecontrol = %s,
+     output = full,
+     c = %s,
+     boot = ,
+     cens = %s);
+ run;"
> 
> 
> cat("
+ ###
+ ### Generate all relevant patterns of %mediation() calls
+ ################################################################################\n")

###
### Generate all relevant patterns of %mediation() calls
################################################################################
> 
> macro_args <-
+     crossing(mreg = c("linear",
+                       "logistic"),
+              yreg = c("linear",
+                       "logistic",
+                       "loglinear",
+                       "poisson",
+                       "negbin",
+                       "survCox",
+                       "survAFT_exp",
+                       "survAFT_weibull"),
+              interaction = c("false","true"),
+              casecontrol = c("false","true"),
+              ## empty cvar may not work with output = full
+              ncvar = c(3)) %>%
+     ## casecontrol is only relevant for binary yreg
+     filter(casecontrol == "false" |
+            (casecontrol == "true" & (yreg == "logistic" | yreg == "loglinear"))) %>%
+     ## Choose appropriate variable names
+     mutate(avar = "trt",
+            ##
+            mvar = case_when(mreg == "linear" ~ "bili",
+                             mreg == "logistic" ~ "bili_bin"),
+            ##
+            yvar = case_when(yreg == "linear" ~ "alk_phos",
+                             ##
+                             yreg == "logistic" ~ "spiders",
+                             yreg == "loglinear" ~ "spiders",
+                             ##
+                             yreg == "poisson" ~ "platelet",
+                             yreg == "negbin" ~ "platelet",
+                             ##
+                             yreg == "survCox" ~ "time",
+                             yreg == "survAFT_exp" ~ "time",
+                             yreg == "survAFT_weibull" ~ "time"),
+            ##
+            eventvar = case_when(yreg == "survCox" ~ "status",
+                                 yreg == "survAFT_exp" ~ "status",
+                                 yreg == "survAFT_weibull" ~ "status",
+                                 TRUE ~ ""),
+            cens = "cens",
+            ##
+            cvar = case_when(ncvar == 0 ~ "",
+                             ncvar == 3 ~ "age male stage"),
+            ##
+            c_cond = case_when(ncvar == 0 ~ "",
+                               ncvar == 3 ~ "50 1 2"),
+            a0 = "1",
+            a1 = "2",
+            m_cde = "1") %>%
+     ## Contruct macro text
+     mutate(macro_call = sprintf(macro_call_string_fmt,
+                                 yvar,
+                                 avar,
+                                 mvar,
+                                 cvar,
+                                 a0,
+                                 a1,
+                                 m_cde,
+                                 yreg,
+                                 mreg,
+                                 interaction,
+                                 casecontrol,
+                                 c_cond,
+                                 cens)) %>%
+     ## Construct the entire sas script
+     mutate(sas_script = paste0(common_string,
+                                macro_call)) %>%
+     ## File name
+     mutate(filename = sprintf("sas-mreg_%s_yreg_%s_int_%s_caco_%s_ncvar%s.sas",
+                               ## All variables in crossing() should appear hear.
+                               mreg,
+                               yreg,
+                               str_sub(interaction, start = 1, end = 1),
+                               str_sub(casecontrol, start = 1, end = 1),
+                               ncvar))
> macro_args %>%
+     print(n = Inf)
# A tibble: 40 x 18
   mreg  yreg  interaction casecontrol ncvar avar  mvar  yvar  eventvar cens  cvar  c_cond a0   
   <chr> <chr> <chr>       <chr>       <dbl> <chr> <chr> <chr> <chr>    <chr> <chr> <chr>  <chr>
 1 line… line… false       false           3 trt   bili  alk_… ""       cens  age … 50 1 2 1    
 2 line… line… true        false           3 trt   bili  alk_… ""       cens  age … 50 1 2 1    
 3 line… logi… false       false           3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 4 line… logi… false       true            3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 5 line… logi… true        false           3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 6 line… logi… true        true            3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 7 line… logl… false       false           3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 8 line… logl… false       true            3 trt   bili  spid… ""       cens  age … 50 1 2 1    
 9 line… logl… true        false           3 trt   bili  spid… ""       cens  age … 50 1 2 1    
10 line… logl… true        true            3 trt   bili  spid… ""       cens  age … 50 1 2 1    
11 line… negb… false       false           3 trt   bili  plat… ""       cens  age … 50 1 2 1    
12 line… negb… true        false           3 trt   bili  plat… ""       cens  age … 50 1 2 1    
13 line… pois… false       false           3 trt   bili  plat… ""       cens  age … 50 1 2 1    
14 line… pois… true        false           3 trt   bili  plat… ""       cens  age … 50 1 2 1    
15 line… surv… false       false           3 trt   bili  time  status   cens  age … 50 1 2 1    
16 line… surv… true        false           3 trt   bili  time  status   cens  age … 50 1 2 1    
17 line… surv… false       false           3 trt   bili  time  status   cens  age … 50 1 2 1    
18 line… surv… true        false           3 trt   bili  time  status   cens  age … 50 1 2 1    
19 line… surv… false       false           3 trt   bili  time  status   cens  age … 50 1 2 1    
20 line… surv… true        false           3 trt   bili  time  status   cens  age … 50 1 2 1    
21 logi… line… false       false           3 trt   bili… alk_… ""       cens  age … 50 1 2 1    
22 logi… line… true        false           3 trt   bili… alk_… ""       cens  age … 50 1 2 1    
23 logi… logi… false       false           3 trt   bili… spid… ""       cens  age … 50 1 2 1    
24 logi… logi… false       true            3 trt   bili… spid… ""       cens  age … 50 1 2 1    
25 logi… logi… true        false           3 trt   bili… spid… ""       cens  age … 50 1 2 1    
26 logi… logi… true        true            3 trt   bili… spid… ""       cens  age … 50 1 2 1    
27 logi… logl… false       false           3 trt   bili… spid… ""       cens  age … 50 1 2 1    
28 logi… logl… false       true            3 trt   bili… spid… ""       cens  age … 50 1 2 1    
29 logi… logl… true        false           3 trt   bili… spid… ""       cens  age … 50 1 2 1    
30 logi… logl… true        true            3 trt   bili… spid… ""       cens  age … 50 1 2 1    
31 logi… negb… false       false           3 trt   bili… plat… ""       cens  age … 50 1 2 1    
32 logi… negb… true        false           3 trt   bili… plat… ""       cens  age … 50 1 2 1    
33 logi… pois… false       false           3 trt   bili… plat… ""       cens  age … 50 1 2 1    
34 logi… pois… true        false           3 trt   bili… plat… ""       cens  age … 50 1 2 1    
35 logi… surv… false       false           3 trt   bili… time  status   cens  age … 50 1 2 1    
36 logi… surv… true        false           3 trt   bili… time  status   cens  age … 50 1 2 1    
37 logi… surv… false       false           3 trt   bili… time  status   cens  age … 50 1 2 1    
38 logi… surv… true        false           3 trt   bili… time  status   cens  age … 50 1 2 1    
39 logi… surv… false       false           3 trt   bili… time  status   cens  age … 50 1 2 1    
40 logi… surv… true        false           3 trt   bili… time  status   cens  age … 50 1 2 1    
# … with 5 more variables: a1 <chr>, m_cde <chr>, macro_call <chr>, sas_script <chr>,
#   filename <chr>
> 
> macro_args %>%
+     select(filename) %>%
+     print(n = Inf)
# A tibble: 40 x 1
   filename                                                      
   <chr>                                                         
 1 sas-mreg_linear_yreg_linear_int_f_caco_f_ncvar3.sas           
 2 sas-mreg_linear_yreg_linear_int_t_caco_f_ncvar3.sas           
 3 sas-mreg_linear_yreg_logistic_int_f_caco_f_ncvar3.sas         
 4 sas-mreg_linear_yreg_logistic_int_f_caco_t_ncvar3.sas         
 5 sas-mreg_linear_yreg_logistic_int_t_caco_f_ncvar3.sas         
 6 sas-mreg_linear_yreg_logistic_int_t_caco_t_ncvar3.sas         
 7 sas-mreg_linear_yreg_loglinear_int_f_caco_f_ncvar3.sas        
 8 sas-mreg_linear_yreg_loglinear_int_f_caco_t_ncvar3.sas        
 9 sas-mreg_linear_yreg_loglinear_int_t_caco_f_ncvar3.sas        
10 sas-mreg_linear_yreg_loglinear_int_t_caco_t_ncvar3.sas        
11 sas-mreg_linear_yreg_negbin_int_f_caco_f_ncvar3.sas           
12 sas-mreg_linear_yreg_negbin_int_t_caco_f_ncvar3.sas           
13 sas-mreg_linear_yreg_poisson_int_f_caco_f_ncvar3.sas          
14 sas-mreg_linear_yreg_poisson_int_t_caco_f_ncvar3.sas          
15 sas-mreg_linear_yreg_survAFT_exp_int_f_caco_f_ncvar3.sas      
16 sas-mreg_linear_yreg_survAFT_exp_int_t_caco_f_ncvar3.sas      
17 sas-mreg_linear_yreg_survAFT_weibull_int_f_caco_f_ncvar3.sas  
18 sas-mreg_linear_yreg_survAFT_weibull_int_t_caco_f_ncvar3.sas  
19 sas-mreg_linear_yreg_survCox_int_f_caco_f_ncvar3.sas          
20 sas-mreg_linear_yreg_survCox_int_t_caco_f_ncvar3.sas          
21 sas-mreg_logistic_yreg_linear_int_f_caco_f_ncvar3.sas         
22 sas-mreg_logistic_yreg_linear_int_t_caco_f_ncvar3.sas         
23 sas-mreg_logistic_yreg_logistic_int_f_caco_f_ncvar3.sas       
24 sas-mreg_logistic_yreg_logistic_int_f_caco_t_ncvar3.sas       
25 sas-mreg_logistic_yreg_logistic_int_t_caco_f_ncvar3.sas       
26 sas-mreg_logistic_yreg_logistic_int_t_caco_t_ncvar3.sas       
27 sas-mreg_logistic_yreg_loglinear_int_f_caco_f_ncvar3.sas      
28 sas-mreg_logistic_yreg_loglinear_int_f_caco_t_ncvar3.sas      
29 sas-mreg_logistic_yreg_loglinear_int_t_caco_f_ncvar3.sas      
30 sas-mreg_logistic_yreg_loglinear_int_t_caco_t_ncvar3.sas      
31 sas-mreg_logistic_yreg_negbin_int_f_caco_f_ncvar3.sas         
32 sas-mreg_logistic_yreg_negbin_int_t_caco_f_ncvar3.sas         
33 sas-mreg_logistic_yreg_poisson_int_f_caco_f_ncvar3.sas        
34 sas-mreg_logistic_yreg_poisson_int_t_caco_f_ncvar3.sas        
35 sas-mreg_logistic_yreg_survAFT_exp_int_f_caco_f_ncvar3.sas    
36 sas-mreg_logistic_yreg_survAFT_exp_int_t_caco_f_ncvar3.sas    
37 sas-mreg_logistic_yreg_survAFT_weibull_int_f_caco_f_ncvar3.sas
38 sas-mreg_logistic_yreg_survAFT_weibull_int_t_caco_f_ncvar3.sas
39 sas-mreg_logistic_yreg_survCox_int_f_caco_f_ncvar3.sas        
40 sas-mreg_logistic_yreg_survCox_int_t_caco_f_ncvar3.sas        
> 
> 
> cat("
+ ###
+ ### Write to sas scripts
+ ################################################################################\n")

###
### Write to sas scripts
################################################################################
> 
> junk <- macro_args %>%
+     mutate(junk = map2(sas_script, filename,
+                        function(sas_script, filename) {
+                            write_lines(x = sas_script, path = filename)
+                        }))
> 
> 
> ################################################################################
> cat("
+ ###
+ ### Record package versions etc
+ ################################################################################\n")

###
### Record package versions etc
################################################################################
> print(sessionInfo())
R version 3.6.1 (2019-07-05)
Platform: x86_64-conda_cos6-linux-gnu (64-bit)
Running under: Red Hat Enterprise Linux Server release 6.10 (Santiago)

Matrix products: default
BLAS/LAPACK: /home/kyoshida/miniconda3/lib/R/lib/libRblas.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8       
 [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
[10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] forcats_0.4.0   stringr_1.4.0   dplyr_0.8.0.1   purrr_0.3.3     readr_1.3.1     tidyr_0.8.3    
[7] tibble_2.1.1    ggplot2_3.1.1   tidyverse_1.2.1

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.1       pillar_1.3.1     compiler_3.6.1   cellranger_1.1.0 plyr_1.8.4      
 [6] tools_3.6.1      jsonlite_1.6     lubridate_1.7.4  gtable_0.3.0     nlme_3.1-139    
[11] lattice_0.20-38  pkgconfig_2.0.2  rlang_0.4.4      cli_1.1.0        rstudioapi_0.10 
[16] haven_2.1.0      withr_2.1.2      xml2_1.2.0       httr_1.4.0       generics_0.0.2  
[21] hms_0.4.2        grid_3.6.1       tidyselect_0.2.5 glue_1.3.1       R6_2.4.0        
[26] fansi_0.4.0      readxl_1.3.1     modelr_0.1.4     magrittr_1.5     backports_1.1.4 
[31] scales_1.0.0     rvest_0.3.3      assertthat_0.2.1 colorspace_1.4-1 utf8_1.1.4      
[36] stringi_1.4.3    lazyeval_0.2.2   munsell_0.5.0    broom_0.5.2      crayon_1.3.4    
> ## Record execution time and multicore use
> end_time <- Sys.time()
> diff_time <- difftime(end_time, start_time, units = "auto")
> 
