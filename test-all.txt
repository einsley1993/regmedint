✔ |  OK F W S | Context
⠋ |   0   1   | ⠏ |   0       | 03_fit_mreg✔ |  24       | 03_fit_mreg
⠏ |   0       | 03_helpers_fit_mreg_fit_yreg✔ |  23       | 03_helpers_fit_mreg_fit_yreg
⠏ |   0       | 04_fit_yreg_linear✔ |  24       | 04_fit_yreg_linear
⠏ |   0       | 04_fit_yreg_logistic✔ |  24       | 04_fit_yreg_logistic
⠏ |   0       | 04_fit_yreg_poisson✔ |  24       | 04_fit_yreg_poisson
⠏ |   0       | 04_fit_yreg_survAFT_exp✔ |  24       | 04_fit_yreg_survAFT_exp
⠏ |   0       | 04_fit_yreg_survAFT_weibull✔ |  24       | 04_fit_yreg_survAFT_weibull
⠏ |   0       | 06_calc_myreg_helpers_coef⠧ |  38       | 06_calc_myreg_helpers_coef⠼ |  85       | 06_calc_myreg_helpers_coef✔ | 109       | 06_calc_myreg_helpers_coef [0.3 s]
⠏ |   0       | 06_calc_myreg_helpers_vcov⠼ |  25       | 06_calc_myreg_helpers_vcov⠸ |  53 1     | 06_calc_myreg_helpers_vcov⠧ |  77 1     | 06_calc_myreg_helpers_vcov⠸ | 103 1     | 06_calc_myreg_helpers_vcov✖ | 108 1     | 06_calc_myreg_helpers_vcov [0.4 s]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
test-06_calc_myreg_helpers_vcov.R:471: error: Sigma_theta_hat (NULL cvar) for yreg survCox: extracts vcov correctly when there is no interaction
invalid or not-yet-implemented 'Matrix' subsetting
1: expect_equal(Sigma_theta_hat(yreg = "survCox", yreg_fit = yreg_fit0, avar = "trt", mvar = "bili", cvar = NULL, interaction = FALSE), 
       ref_vcov) at /inv/kyoshida/cantos_stats/regmedint/tests/testthat/test-06_calc_myreg_helpers_vcov.R:471
2: quasi_label(enquo(object), label, arg = "object")
3: eval_bare(get_expr(quo), get_env(quo))
4: Sigma_theta_hat(yreg = "survCox", yreg_fit = yreg_fit0, avar = "trt", mvar = "bili", cvar = NULL, interaction = FALSE)
5: Matrix::bdiag(vcov_ready[c("(Intercept)", avar, mvar), c("(Intercept)", avar, mvar), drop = FALSE], matrix(0), vcov_ready[cvar, 
       cvar, drop = FALSE]) at /inv/kyoshida/cantos_stats/regmedint/R/06_calc_myreg_helpers_vcov.R:63
6: vcov_ready[cvar, cvar, drop = FALSE] at /inv/kyoshida/cantos_stats/regmedint/R/06_calc_myreg_helpers_vcov.R:63
7: vcov_ready[cvar, cvar, drop = FALSE]
8: stop("invalid or not-yet-implemented 'Matrix' subsetting")
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
⠏ |   0       | 07_calc_myreg_mreg_linear_yreg_linear✔ |   0     2 | 07_calc_myreg_mreg_linear_yreg_linear
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
test-07_calc_myreg_mreg_linear_yreg_linear.R:17: skip: calc_myreg_mreg_linear_yreg_linear_est works given coef
Empty test

test-07_calc_myreg_mreg_linear_yreg_linear.R:26: skip: calc_myreg_mreg_linear_yreg_linear_se works given coef and vcov
Empty test
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
⠹ |   0 1   2 | 07_calc_myreg_mreg_linear_yreg_linear✖ |   0 1   2 | 07_calc_myreg_mreg_linear_yreg_linear
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
test-07_calc_myreg_mreg_linear_yreg_logistic.R:18: error: (unknown)
object 'Sigma_beta' not found
1: describe("calc_myreg_mreg_linear_yreg_logistic", {
       data(pbc)
       pbc_cc <- pbc[complete.cases(pbc), ] %>% mutate(male = if_else(sex == "m", 1L, 0L), status = if_else(status == 0, 0L, 
           1L))
       describe("calc_myreg_mreg_linear_yreg_logistic(cvar = NULL)", {
           mreg_fit <- fit_mreg(mreg = "linear", data = pbc_cc, avar = "trt", mvar = "bili", cvar = NULL)
           yreg_fit <- fit_yreg(yreg = "logistic", data = pbc_cc, yvar = "spiders", avar = "trt", mvar = "bili", cvar = NULL, 
               interaction = FALSE, eventvar = NULL)
           myreg_funs <- calc_myreg_mreg_linear_yreg_logistic(mreg = "linear", mreg_fit = mreg_fit, yreg = "logistic", yreg_fit = yreg_fit, 
               avar = "trt", mvar = "bili", cvar = NULL, interaction = FALSE)
           it("returns a list of two functions", {
               expect_equal(class(myreg_funs), "list")
               expect_equal(length(myreg_funs), 2)
           })
           it("returns functions that take 4 arguments", {
               expect_equal(formals(myreg_funs[[1]]), c("a0", "a1", "m_cde", "c_cond"))
               expect_equal(formals(myreg_funs[[2]]), c("a0", "a1", "m_cde", "c_cond"))
           })
           it("returns functions that return named vector of effect estimates", {
               expect(names(myreg_funs[[1]](1, 2, 3, NULL)), c("cde", "pnde", "tnie", "tnde", "pnie", "te", "pm"))
               expect(names(myreg_funs[[2]](1, 2, 3, NULL)), c("se_cde", "se_pnde", "se_tnie", "se_tnde", "se_pnie", "se_te", 
                   "se_pm"))
           })
           it("returns functions that error on inconsistent c_cond", {
               expect_error(myreg_funs[[1]](1, 2, 3, 4))
               expect_error(myreg_funs[[2]](1, 2, 3, 4))
           })
       })
   }) at /inv/kyoshida/cantos_stats/regmedint/tests/testthat/test-07_calc_myreg_mreg_linear_yreg_logistic.R:18
2: eval(substitute(code), describe_environment)
3: eval(substitute(code), describe_environment)
4: describe("calc_myreg_mreg_linear_yreg_logistic(cvar = NULL)", {
       mreg_fit <- fit_mreg(mreg = "linear", data = pbc_cc, avar = "trt", mvar = "bili", cvar = NULL)
       yreg_fit <- fit_yreg(yreg = "logistic", data = pbc_cc, yvar = "spiders", avar = "trt", mvar = "bili", cvar = NULL, interaction = FALSE, 
           eventvar = NULL)
       myreg_funs <- calc_myreg_mreg_linear_yreg_logistic(mreg = "linear", mreg_fit = mreg_fit, yreg = "logistic", yreg_fit = yreg_fit, 
           avar = "trt", mvar = "bili", cvar = NULL, interaction = FALSE)
       it("returns a list of two functions", {
           expect_equal(class(myreg_funs), "list")
           expect_equal(length(myreg_funs), 2)
       })
       it("returns functions that take 4 arguments", {
           expect_equal(formals(myreg_funs[[1]]), c("a0", "a1", "m_cde", "c_cond"))
           expect_equal(formals(myreg_funs[[2]]), c("a0", "a1", "m_cde", "c_cond"))
       })
       it("returns functions that return named vector of effect estimates", {
           expect(names(myreg_funs[[1]](1, 2, 3, NULL)), c("cde", "pnde", "tnie", "tnde", "pnie", "te", "pm"))
           expect(names(myreg_funs[[2]](1, 2, 3, NULL)), c("se_cde", "se_pnde", "se_tnie", "se_tnde", "se_pnie", "se_te", "se_pm"))
       })
       it("returns functions that error on inconsistent c_cond", {
           expect_error(myreg_funs[[1]](1, 2, 3, 4))
           expect_error(myreg_funs[[2]](1, 2, 3, 4))
       })
   }) at /inv/kyoshida/cantos_stats/regmedint/tests/testthat/test-07_calc_myreg_mreg_linear_yreg_logistic.R:27
5: eval(substitute(code), describe_environment)
6: eval(substitute(code), describe_environment)
7: calc_myreg_mreg_linear_yreg_logistic(mreg = "linear", mreg_fit = mreg_fit, yreg = "logistic", yreg_fit = yreg_fit, avar = "trt", 
       mvar = "bili", cvar = NULL, interaction = FALSE) at /inv/kyoshida/cantos_stats/regmedint/tests/testthat/test-07_calc_myreg_mreg_linear_yreg_logistic.R:41
8: calc_myreg_mreg_linear_yreg_logistic_se(beta0 = beta0, beta1 = beta1, beta2 = beta2, theta1 = theta1, theta2 = theta2, theta3 = theta3, 
       theta4 = theta4, sigma_sq = sigma_sq, Sigma_beta = Sigma_beta, Sigma_theta = Sigma_theta, Sigma_sigma = Sigma_sigma) at /inv/kyoshida/cantos_stats/regmedint/R/07_calc_myreg_mreg_linear_yreg_logistic.R:85
9: Matrix::bdiag(Sigma_beta, Sigma_theta, Sigma_sigma) at /inv/kyoshida/cantos_stats/regmedint/R/07_calc_myreg_mreg_linear_yreg_logistic.R:188
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
⠏ |   0       | 07_calc_myreg_mreg_logistic_yreg_linear✔ |   0     2 | 07_calc_myreg_mreg_logistic_yreg_linear
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
test-07_calc_myreg_mreg_logistic_yreg_linear.R:17: skip: calc_myreg_mreg_logistic_yreg_linear_est works given coef
Empty test

test-07_calc_myreg_mreg_logistic_yreg_linear.R:26: skip: calc_myreg_mreg_logistic_yreg_linear_se works given coef and vcov
Empty test
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
⠏ |   0       | 07_calc_myreg_mreg_logistic_yreg_logistic✔ |   0     2 | 07_calc_myreg_mreg_logistic_yreg_logistic
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
test-07_calc_myreg_mreg_logistic_yreg_logistic.R:17: skip: calc_myreg_mreg_logistic_yreg_logistic_est works given coef
Empty test

test-07_calc_myreg_mreg_logistic_yreg_logistic.R:26: skip: calc_myreg_mreg_logistic_yreg_logistic_se works given coef and vcov
Empty test
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════════════════════════════════════════════
Duration: 2.7 s

OK:       384
Failed:   2
Warnings: 1
Skipped:  6
